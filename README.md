# Html Query Language

A fast and human-friendly Html Query Language with well-defined grammar, written in Rust

> It's mainly a rust code library, while provides a simple command line tool

## Grammar

HQL performs like linux pipe: it consists of multiple selectors acted like filter, with data flowing among selectors.

The HQL basic format is `${selector1} | ${selector2} | ...`

Each selector receives nodes generated by the previous selector and returns a set of nodes passing to next selectors. The global input node is the root of the HTML document

For example, one can select all `a` tags with `target=_blank` attribute:

```
@path(`//a`) | @attr(`target`, `_blank`)
```

For more details, please view [grammar.pest](./src/selector/grammar.pest).

## QuickStart

first, add hql as dependencies: `cargo add hql`

### Library

```rust
use hql::{html, querier};

// parse html document
let doc = html::Html::parse_document(&file_content, false);

// parse HQL, generating a querier, which is basically a wrapper of Vec<Selector>
// use Display implementation of Err to show more human readable parse error.
let q = querier::Querier::try_parse("@flat()").unwrap_or_else(|e| panic!("failed to parse hql: {}", e));

// query document, yielding filtered nodes
q.query_document(&doc).into_iter().for_each(|n| println!("{}", n));
```

Each node in the flow is a `ElementOrTextRef`, which is a enum:

```rust
pub enum ElementOrTextRef<'a> {
    Element(ElementRef<'a>),
    Text(TextRef<'a>),
    PhantomText(PhantomTextRef),
}
```

The `Element` and `Text` are existed nodes in the original HTML document while `PhantomText` is an intermediate text nodes generated by some selectors, like `@trimPrefix(`....`)`. It is mainly used to distinguished with existed `Text` nodes. It has basically the same API like `Text`. One can retrieve their inner text by `text()`. 

For more detailed exposed API, please read functions document.

### Cli

Now, it is only available via cargo:  `cargo install hql`

`hql` can receive HTML from tree channel, with priority from high to low:

- file: specified by `-f [FILE]`
- inline argument: `hql ... [DOCUMENT]`
- stdin: `hql < [DOCUMENT]`

Stdin mode is useful for piping with other commands, like

```
curl https://www.google.com/ | hql --hql "@path(`//a`) | #text() | #trim()"
```

## Benchmark

It is a very fast tool.

## Planning

- [ ] Add regular expression support for text handle
- [ ] Add partial `xpath` syntax support by converting it into HQL
- [ ] Add partial `css-selector` syntax support by converting it into HQL